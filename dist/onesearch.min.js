function inArray(a,b){return b.indexOf(a)>-1}function isEmpty(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function toArray(a){return Array.isArray(a)?a:Object.keys(a).map(function(b){return a[b]})}angular.module("oneSearch.templates",["bento/bento.tpl.html","common/directives/suggest/suggest.tpl.html","common/engines/acumen/acumen.tpl.html","common/engines/catalog/catalog.tpl.html","common/engines/databases/databases.tpl.html","common/engines/ejournals/ejournals.tpl.html","common/engines/google-cs/google-cs.tpl.html","common/engines/libguides/libguides.tpl.html","common/engines/recommend/recommend.tpl.html","common/engines/scout/scout.tpl.html","common/engines/staff-directory/staff-directory.tpl.html"]),angular.module("bento/bento.tpl.html",[]).run(["$templateCache",function(a){a.put("bento/bento.tpl.html",'<div class="container bento-box-container">\n    <div class="row">\n        <div class="col-md-12">\n            <h1 class="h2">OneSearch Results</h1>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="articles">\n                <h2>\n                    Articles\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip="Keyword search in journal titles and full text article content in Scout."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="books">\n                <h2>\n                    Books\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip="Keyword search in book titles using both the Libraries\' Catalog and Scout."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n        <div class="col-sm-12 col-md-4">\n            <div class="bento-box" bento-box="journals">\n                <h2>\n                    Journals\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip="Keyword search in journal titles and journal collections, in both Scout and our E-Resources."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-12">\n            <div class="bento-box" hide-if-empty="true" bento-box="staffdirectory" style="min-height:0px; margin-bottom: 15px;">\n                <h2>\n                    Research Help\n                    <small>\n                            <span class="fa fa-info-circle"\n                                  tooltip-placement="right"\n                                  tooltip="Contact a librarian directly for help with your research."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="databases">\n                <h2>\n                    Databases\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip="Keyword search in titles and databases descriptions from our own Databases page."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="googleCS">\n                <h2 id="site-search">\n                    Libraries\' Website\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip="Targeted, full-text search of library website pages and sections."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="acumen">\n                <h2 id="acumen">\n                    Acumen <small>Digital Archives</small>\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip="Returns a keyword search in titles and full text of our Special Collections Digital Archive."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="other">\n                <h2>\n                    Other Items & Media\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip="Keyword and item type search in the Libraries\' catalog and Scout, retrieving media items - videos, DVDs, CDs, etc."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="faq">\n                <h2>\n                    FAQ\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip=\'Full text keyword search via our Google search engine interface, through our FAQ repository, also known as "Ask a Librarian."\'></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="libguides">\n                <h2>\n                    Research Guides\n                    <small>\n                        <span class="fa fa-info-circle"\n                              tooltip-placement="right"\n                              tooltip="Uses Google API to run a keyword search in titles and full text for our research guides."></span>\n                    </small>\n                </h2>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-12">\n            <div class="bento-box well" bento-box="recommend" hide-if-empty="true" omit-from-menu="true">\n                <h2>\n                    Recommended Links\n                </h2>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("common/directives/suggest/suggest.tpl.html",[]).run(["$templateCache",function(a){a.put("common/directives/suggest/suggest.tpl.html",'<div class="input-group input-group-lg">\n    <label class="sr-only" for="osTextField">Search terms</label>\n    <input type="text" name="search" class="form-control onesearch-text" placeholder="{{prompt}}" id="osTextField"\n           ng-model="model" ng-change="onChange()" ng-trim="false" autocomplete="off" />\n    <div class="input-group-btn">\n        <button type="submit" class="btn btn-onesearch btn-primary"><span class="fa fa-search" aria-hidden="true"></span><span class="sr-only">Search OneSearch</span></button>\n\n    </div>\n\n</div>\n\n<div class="suggest" ng-show="showSuggestions && selected && (items.suggest.length > 0 || items.recommend.length > 0 || items.subjects[0].subjects.length > 0 || items.faq.length > 0)">\n    <div ng-if="items.suggest.length > 0">\n        <ul class="nav nav-pills nav-stacked">\n            <li role="presentation"\n                ng-repeat="item in filteredItems = (items.suggest | filter:compare(originalValue)) | limitTo:numShow track by $index"\n                ng-mousedown="handleSelection(item.search)" ng-class="item.class"\n                ng-mouseenter="setCurrent($index, false)">\n                <a href="#/bento/{{item.search}}" ng-click="gaTypeAhead(item.search)">{{item.search}}</a>\n            </li>\n        </ul>\n    </div>\n    <div class="suggest-row" ng-show="items.recommend.length > 0 || items.subjects[0].subjects.length > 0 || items.faq.length > 0">\n        <div class="row">\n            <div class="col-sm-4 suggest-col" ng-show="items.recommend.length > 0">\n                <div class="">\n                    <h4>Recommended Links</h4>\n                    <div ng-repeat="recommendation in items.recommend | limitTo:10">\n                        <a ng-href="{{recommendation.link}}" ng-click="gaSuggestion(recommendation.description)">\n                            {{recommendation.description}}\n                        </a>\n                    </div>\n                </div>\n            </div>\n            <div class="col-sm-4 suggest-col" ng-show="items.subjects[0].subjects.length > 0">\n                <div class="">\n                    <h4>Research Guides&#39; Subjects <a href="http://guides.lib.ua.edu/" class="small" ng-mousedown="go(\'http://guides.lib.ua.edu/\')">more guides</a></h4>\n                    <div ng-repeat="person in items.subjects | limitTo:10">\n                        <div ng-repeat="subject in person.subjects | limitTo:2">\n                            <a ng-if="subject.link.length > 7" ng-href="{{subject.link}}" ng-mousedown="go(subject.link)" ng-click="gaSuggestion(subject.subject)">\n                                {{subject.subject}}\n                            </a>\n                            <a ng-if="subject.link.length <= 7" href="#"\n                               ng-mousedown="go(\'mailto:\' + person.email + \'?subject=Question\')">\n                                Ask {{person.name}}, {{person.title}} at {{person.department}}\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="col-sm-4 suggest-col" ng-show="items.faq.length > 0">\n                <div class="">\n                    <h4>FAQ <a href="http://ask.lib.ua.edu/" class="small" ng-mousedown="go(\'http://ask.lib.ua.edu/\')">more FAQs</a></h4>\n                    <div ng-repeat="faq in items.faq | limitTo:5">\n                        <a ng-href="{{faq.link}}" ng-mousedown="go(faq.link)"  ng-click="gaSuggestion(faq.title)" ng-bind-html="faq.title">\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("common/engines/acumen/acumen.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/acumen/acumen.tpl.html",'<div class="media">\n    <a class="pull-left" ng-href="http://acumen.lib.ua.edu/{{item.link}}"  target="_acumen">\n        <img ng-src="{{item.thumb_path}}" alt="{{item.title}}">\n    </a>\n    <div class="media-body">\n        <h3 class="h4 media-heading">\n            <a ng-href="http://acumen.lib.ua.edu/{{item.link}}" target="_acumen"  ng-click="gaPush()">{{item.title | truncate: 40: \'...\': true}}</a>\n        </h3>\n        <div class="details-context">\n            <span ng-if="item.date" ng-bind-html="item.date"></span>\n            <span ng-if="item.type" ng-bind-html="item.type | ucfirst"></span>\n        </div>\n        <p>{{item.description | truncate: 100: \'...\': true}}</p>\n        <ul class="list-inline">\n            <li>\n                <a ng-href="{{resourceLink}}" class="external-link" ng-if="resourceLink" target="_{{engine}}" ng-click="gaMore()">Results in {{engineName}}</a>\n            </li>\n        </ul>\n    </div>\n</div>')}]),angular.module("common/engines/catalog/catalog.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/catalog/catalog.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h3 class="h4 media-heading">\n            <a ng-href="{{item.href}}"\n               ng-bind-html="item.title | truncate: 50: \'...\': true" target="_catalog" ng-click="gaPush()"></a>\n        </h3>\n        <div class="details-context">\n            <span ng-if="item.year && item.year | number" ng-bind-html="item.year"></span>\n            <span ng-if="item.mediaType" ng-bind-html="item.mediaType"></span>\n            <span ng-if="item.issn">ISSN: {{item.issn}}</span>\n        </div>\n        <div collapse="isCollapsed" class="details-container" ng-if="item.author">\n            <span class="text-muted">Author(s)</span>\n            <span class="detail">\n                <span ng-bind-html="item.author | lowercase | ucfirst"></span>\n            </span>\n        </div>\n        <ul class="list-inline">\n            <li ng-show="item.author">\n                <a href="" ng-click="isCollapsed = !isCollapsed">Item details <span class="fa" ng-class="{\'fa-caret-down\': isCollapsed, \'fa-caret-up\': !isCollapsed}"></span></a>\n            </li>\n            <li>\n                <a ng-href="{{resourceLink}}" class="external-link" ng-if="resourceLink" target="_{{engine}}" ng-click="gaMore()">Results in {{engineName}}</a>\n            </li>\n        </ul>\n    </div>\n</div>')}]),angular.module("common/engines/databases/databases.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/databases/databases.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h3 class="h4 media-heading">\n            <a ng-href="{{item.url}}" title="{{item.title}}" target="_databases" ng-click="gaPush()">{{item.title | truncate: 40: \'...\': true}}</a>\n        </h3>\n        <div class="details-context">\n            <span ng-if="item.coverage" ng-bind-html="item.coverage"></span>\n        </div>\n        <div class="details-container" ng-if="item.subjects">\n            <span class="text-muted">Subjects: </span>\n            <span class="detail" ng-repeat="subj in item.subjects">{{subj.subject}}{{$last ? \'\' : \', \'}}</span>\n        </div>\n    </div>\n</div>')}]),angular.module("common/engines/ejournals/ejournals.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/ejournals/ejournals.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h3 class="h4 media-heading">\n            <a ng-href="{{item.PLink}}"\n               target="_scout"\n               ng-bind-html="item.title | lowercase | ucfirst | truncate: 80: \'...\': true" ng-click="gaPush()"></a>\n\n        </h3>\n        <div class="details-context">\n            <span ng-if="item.year">{{item.year}}</span>\n            <span ng-if="item.ISSN">ISSN: {{item.ISSN}}</span>\n            <span ng-if="item.mediaType">{{item.mediaType}} </span>\n            <span ng-if="item.FullText.Text.Availability">Full Text Online</span>\n        </div>\n\n        <ul class="list-inline">\n            <li>\n                <a ng-href="{{resourceLink}}" class="external-link" ng-if="resourceLink" target="_{{engine}}" ng-click="gaMore()">Results in {{engineName}}</a>\n            </li>\n        </ul>\n\n\n    </div>\n</div>')}]),angular.module("common/engines/google-cs/google-cs.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/google-cs/google-cs.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h3 class="h4 media-heading"><a ng-href="{{item.link}}" title="{{item.title}}" target="_googlecs" ng-click="gaPush()">{{item.title | truncate: 40: \'...\': true}}</a></h3>\n        <p ng-bind-html="item.snippet | truncate: 100: \'...\': true"></p>\n        <ul class="list-inline">\n            <li>\n                <a ng-href="{{resourceLink}}" class="external-link" ng-if="resourceLink" target="_{{engine}}" ng-click="gaMore()">Results in {{engineName}}</a>\n            </li>\n        </ul>\n    </div>\n</div>')}]),angular.module("common/engines/libguides/libguides.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/libguides/libguides.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h3 class="h4 media-heading"><a ng-href="{{item.url}}"  target="_libguides" ng-click="gaPush()">{{item.name | truncate: 40: \'...\': true}}</a></h3>\n        <p ng-bind-html="item.description | truncate: 100: \'...\': true"></p>\n        <ul class="list-inline">\n            <li>\n                <a ng-href="{{resourceLink}}" class="external-link" ng-if="resourceLink" target="_{{engine}}" ng-click="gaMore()">Results in {{engineName}}</a>\n            </li>\n        </ul>\n    </div>\n</div>\n\n\n\n')}]),angular.module("common/engines/recommend/recommend.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/recommend/recommend.tpl.html",'<a ng-href="{{item.link}}" title="{{item.descr}}">{{item.descr}}</a>\n')}]),angular.module("common/engines/scout/scout.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/scout/scout.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h3 class="h4 media-heading">\n            <a ng-href="{{item.PLink}}"\n               title="{{item.Items[0].Data}}"\n               target="_scout"\n               ng-bind-html="item.title | lowercase | ucfirst | truncate: 80: \'...\': true" ng-click="gaPush()"></a>\n        </h3>\n        <div class="details-context">\n            <span ng-if="item.RecordInfo.BibRecord.BibRelationships.IsPartOfRelationships[0].BibEntity.Dates[0]">{{item.RecordInfo.BibRecord.BibRelationships.IsPartOfRelationships[0].BibEntity.Dates[0].Y}} </span>\n            <span ng-if="item.mediaType">{{item.mediaType}} </span>\n            <span ng-if="item.FullText.Text.Availability">Full Text Online</span>\n        </div>\n        <div collapse="isCollapsed" ng-show="(item.RecordInfo.BibRecord.BibRelationships.HasContributorRelationships || item.source || item.RecordInfo.BibRecord.BibEntity.Subjects)">\n            <div class="details-container" ng-if="item.RecordInfo.BibRecord.BibRelationships.HasContributorRelationships">\n                <span class="text-muted">Authors </span>\n            <span class="details"...\n                  ..\n\n                  ng-repeat="author in item.RecordInfo.BibRecord.BibRelationships.HasContributorRelationships | unique: \'PersonEntity.Name.NameFull\'"\n                  ng-bind-html="author.PersonEntity.Name.NameFull | lowercase | ucfirst"></span>\n            </div>\n\n            <div class="details-container" ng-if="item.source">\n                <span class="text-muted">Sources </span>\n                <span class="details" ng-bind-html="item.source"></span>\n            </div>\n\n            <div class="details-container" ng-if="item.RecordInfo.BibRecord.BibEntity.Subjects">\n                <span class="text-muted">Subjects </span>\n            <span class="details"\n                  ng-repeat="subject in item.RecordInfo.BibRecord.BibEntity.Subjects"\n                  ng-bind-html="subject.SubjectFull"></span>\n            </div>\n        </div>\n        <ul class="list-inline">\n            <li ng-show="item.RecordInfo.BibRecord.BibRelationships.HasContributorRelationships || item.source || item.RecordInfo.BibRecord.BibEntity.Subjects">\n                <a href="" ng-click="isCollapsed = !isCollapsed">Item details <span class="fa" ng-class="{\'fa-caret-down\': isCollapsed, \'fa-caret-up\': !isCollapsed}"></span></a>\n            </li>\n            <li>\n                <a ng-href="{{resourceLink}}" class="external-link" ng-if="resourceLink" target="_{{engine}}" ng-click="gaMore()">Results in {{engineName}}</a>\n            </li>\n        </ul>\n\n    </div>\n</div>')}]),angular.module("common/engines/staff-directory/staff-directory.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/staff-directory/staff-directory.tpl.html",'<div class="col-md-4">\n    <div class="media">\n        <div class="media-left">\n                <img ng-if="item.photo" class="media-object" style="width: 128px;" src=\'https://wwwdev2.lib.ua.edu/staffDir/staffImages/{{item.photo}}\' alt="Staff Directory Image of {{item.firstName}} {{item.lastName}}" />\n                <img ng-if="!item.photo" class="media-object" style="width: 128px;" src="https://www.lib.ua.edu/wp-content/themes/roots-ualib/assets/img/user-profile.png" alt="Staff Directory Image of {{item.firstName}} {{item.lastName}}" />\n        </div>\n        <div class="media-body">\n            <div class="media-heading">\n                <dl class="list-unstyled">\n                    <dt>Name</dt>\n                    <dd><a ng-href="#/staffdir/{{item.emailPrefix}}" ng-if="item.profile">\n                        {{item.firstName}} {{item.lastName}}\n                    </a></dd>\n                    <dd ng-if="!item.profile">{{item.firstName}} {{item.lastName}} </dd>\n                    <dt>Subject</dt>\n                    <dd>{{item.subject}}</dd>\n                    <dt>Phone</dt>\n                    <dd>{{item.title}}</dd>\n                    <!--<div class="media-heading">{{item.department}}</div>-->\n                    <dt>Email</dt>\n                    <dd><a href="mailto:{{item.email}}?subject=Research Help Request" ng-click="gaResearchRequest(item.firstName + \' \' + item.lastName)">{{item.email}}</a></dd>\n                </dl>\n            </div>\n        </div>\n    </div>\n</div>\n\n\n\n\n')}]),angular.module("oneSearch",["ngRoute","ngResource","ngAnimate","ngSanitize","ui.bootstrap","angular.filter","ualib.ui","oneSearch.common","oneSearch.templates","oneSearch.bento"]).constant("UALIB_DOMAIN","//wwwdev2.lib.ua.edu/").value("SearchParams",{limit:100}),angular.module("oneSearch.bento",[]).config(["$routeProvider",function(a){a.when("/bento/:s",{templateUrl:"bento/bento.tpl.html",controller:"BentoCtrl"})}]).service("Bento",["$routeParams","$rootScope","$q","oneSearch","mediaTypes",function(a,b,c,d,e){function f(a,b){var c=j.boxes[a].engines.indexOf(b);-1!=c&&(i(a),j.boxes[a].engines.splice(c,1))}function g(a){angular.forEach(j.boxes,function(b,c){f(c,a)})}function h(a){var b=j.boxes[a].engines.length,c=b>1?1:2>b?3:2;j.boxes[a].resultLimit=c}function i(a){c.when(j.boxes[a].results).then(function(b){var c=Object.keys(b).length,d=j.boxes[a].engines.length,e=c+d;"articles"==a||"databases"==a?j.boxes[a].resultLimit=6:"journals"==a?j.boxes[a].resultLimit=2>e&&3==j.boxes[a].resultLimit?6:3:"books"==a&&(j.boxes[a].resultLimit=3>e&&2==j.boxes[a].resultLimit?3:2>e&&3==j.boxes[a].resultLimit?6:2),(2>e&&j.boxes[a].resultLimit<3||3>e&&j.boxes[a].resultLimit<2)&&j.boxes[a].resultLimit++})}var j=this;this.boxes={},this.engines={};var k;this.getBoxes=function(){k=d.searchAll(a),angular.copy(e.types,j.boxes),angular.forEach(j.boxes,function(a,b){h(b),j.boxes[b].results={},j.boxes[b].resourceLinks={},j.boxes[b].resourceLinkParams={}}),angular.forEach(k,function(a,b){a.response.then(function(c){var h=a.getResults(c),i=a.getResourceLink(c);if(isEmpty(h))g(b);else{h=h.map(function(a,b){var c=a;return c.position=b,c});var k=e.groupBy(h,a.mediaTypes);Object.keys(j.boxes).forEach(function(c){k.hasOwnProperty(c)&&(j.boxes[c].results[b]=k[c].sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),j.boxes[c].resourceLinks[b]=decodeURIComponent(i[a.id]),a.resourceLink&&a.resourceLink.params?j.boxes[c].resourceLinkParams[b]=a.resourceLink.params:angular.isObject(a.mediaTypes)&&(j.boxes[c].resourceLinkParams[b]=a.mediaTypes.types[c])),f(c,b)}),j.engines[b]={},j.engines[b].tpl=d.getEngineTemplate(a),j.engines[b].controller=d.getEngineController(a)}},function(){g(b)})})}}]).controller("BentoCtrl",["$scope","Bento",function(a,b){a.$on("$routeChangeSuccess",function(){b.getBoxes()})}]).directive("bentoBox",["$rootScope","$controller","$compile","$animate","$timeout","Bento","oneSearch",function(a,b,c,d,e,f,g){return{restrict:"A",scope:{},link:function(h,i,j){function k(){var a=angular.copy(f.boxes[m].engines),b=[];for(var c in g.engines)a.indexOf(c)>-1&&g.engines[c].response&&!g.engines[c].response.done&&b.push(c);q&&!n.hasClass("unresponsive")&&(n.addClass("unresponsive"),d.enter(r,n,angular.element(n[0].lastChild))),b.length&&(q=e(k,500))}function l(a){isEmpty(f.boxes[a].results)&&(j.hideIfEmpty?i.addClass("hidden"):(i.append("<strong>No Results</strong>"),i.addClass("text-muted"))),d.leave(n),s()}var m=j.bentoBox;i.addClass(m),i.parent().attr("id",m+"-parent"),h.bento=f;var n=angular.element('<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>'),o=i.find("h2");o.attr("id",m);var p=o.text();d.enter(n,o,angular.element(o[0].lastChild));var q,r=angular.element(' <span class="unresponsive-msg">Awaiting results from provider</span>');e(k,2e3);var s=h.$watchCollection(function(){return f.boxes[m].engines},function(d,e){if(d!==e){for(var h="",j=0,k=e.length;k>j;j++){var n=e[j];if(d.indexOf(n)<0){h=n;break}}var o=a.$new();o.items=f.boxes[m].results[h],o.items&&o.items.length>0?(o.isCollapsed=!0,o.engine=h,o.engineName=g.engines[h].title?g.engines[h].title:h.charAt(0).toUpperCase()+h.slice(1),o.resourceLink="undefined"===f.boxes[m].resourceLinks[h]?!1:f.boxes[m].resourceLinks[h],o.resourceLinkParams=f.boxes[m].resourceLinkParams[h],g.engines[h].resourceLink&&g.engines[h].resourceLink.params&&(o.resourceLinkParams=g.engines[h].resourceLink.params),o.boxName=p,o.mediaType=m,f.engines[h].tpl.then(function(a){var d=["$scope","$element","Bento",function(a,c,d){d.engines[a.engine].controller&&angular.extend(this,b(d.engines[a.engine].controller,{$scope:a}));var e=a.boxName.toLowerCase().trim().replace(/\s+/g,"_").replace(/[']+/g,"");a.box=d.boxes[m],a.gaPush=function(){ga("send","event","oneSearch","item_click",e)},a.gaMore=function(){ga("send","event","oneSearch","more_click","more_"+e)},a.gaResearchRequest=function(a){ga("send","event","oneSearch","research_request",a)}}],e=b(d,{$scope:o,$element:i});i.data("$ngControllerController",e),i.children().data("$ngControllerController",e);var f=angular.element('<div class="animate-repeat bento-box-item" ng-repeat="item in items | limitTo: box.resultLimit">'+a+"</div>"),g=c(f)(o);i.append(g)})):a.$broadcast("NoResultsForEngine",{engine:h,box:m}),0===d.length&&l(m)}},!0)}}}]),angular.module("oneSearch.common",["common.mediaTypes","common.oneSearch","common.engines","filters.nameFilter"]),angular.module("oneSearch.common").factory("dataFactory",["$http",function(a){return{get:function(b){return a.get(b).then(function(a){return a.data})}}}]).directive("suggestOneSearch",["$timeout","$document",function(a,b){return{restrict:"AEC",scope:{prompt:"@",model:"=",search:"="},controller:["$scope","$window","$timeout","$document","dataFactory","Bento",function(a,b,c,d,e){a.items={},a.filteredItems=[],a.model="",a.current=-1,a.originalValue=a.model,a.dataRequested=!1,a.numShow=5,a.faqSearched=!1,a.selected=!1,a.onChange=function(){a.selected=!0;var b=a.model.replace(/[&\/\\#+()$~%':*?<>{}]/g," ").trim();if(b=b.substring(0,150),(a.model.length<3||a.model.indexOf(a.originalValue)<0&&a.model.length>=a.originalValue.length||a.originalValue.indexOf(a.model)<0&&a.model.length<=a.originalValue.length)&&(a.items={},a.setCurrent(-1,!1),a.dataRequested=!1,a.selected=!1,a.faqSearched=!1),a.model.length>2&&!a.dataRequested&&(a.dataRequested=!0),a.model.length>2&&c(function(){e.get("//wwwdev2.lib.ua.edu/oneSearch/api/recommend/"+encodeURI(b)).then(function(b){a.items.recommend=b}),e.get("//wwwdev2.lib.ua.edu/staffDir/api/subject/"+encodeURI(b)+"/match/startwith").then(function(b){a.items.subjects=b})},0),a.model.length>4&&!a.faqSearched){var d=b.slice(-2);d.indexOf(" ")>0&&c(function(){a.faqSearched=!0,e.get("https://www.googleapis.com/customsearch/v1?key=AIzaSyCMGfdDaSfjqv5zYoS0mTJnOT3e9MURWkU&cx=003453353330912650815:lfyr_-azrxe&q="+encodeURI(b)+"&siteSearch=ask.lib.ua.edu").then(function(b){a.items.faq=b.items})},0)}a.originalValue=a.model},a.go=function(c){a.model="",a.originalValue=a.model,b.location.href=c},a.setCurrent=function(b,c){if(a.current=b,"undefined"!=typeof a.items.suggest)for(var d=0;d<a.items.suggest.length;d++)a.items.suggest[d]["class"]="";b>=0&&a.filteredItems.length>0&&(b>a.filteredItems.length-1&&(b=a.filteredItems.length-1),c&&(a.model=a.filteredItems[b].search),a.filteredItems[b]["class"]="active",a.current=b)},a.onFocus=function(){angular.isDefined(a.model)&&a.model.length>2&&(a.selected=!0)},a.onBlur=function(){a.selected=!1,d.unbind("click")},a.compare=function(a){return function(b){return 0!=b.search.indexOf(a)||angular.equals(b.search.toLowerCase(),a.toLowerCase())?!1:!0}},a.gaSuggestion=function(a){ga("send","event","oneSearch","suggestion_click",a)},a.gaTypeAhead=function(a){ga("send","event","oneSearch","type_ahead_click",a)}}],link:function(c,d){c.showSuggestions=!1;var e=c.$watch("items",function(a){var b=!1;for(var d in a)if(d.length>0){b=!0;break}c.showSuggestions=c.model.length>2&&b},!0);d.bind("keydown",function(a){switch(a.keyCode){case 38:c.current>0?(c.setCurrent(c.current-1,!0),a.preventDefault()):(c.setCurrent(-1,!1),c.model=c.originalValue,a.preventDefault());break;case 40:c.model.length>2&&c.current<c.numShow-1&&c.current<c.items.suggest.length-1&&(c.setCurrent(c.current+1,!0),a.preventDefault());break;case 13:c.selected=!1,c.current>-1&&c.filteredItems[c.current]&&c.model===c.filteredItems[c.current].search&&c.gaTypeAhead(c.model);break;case 8:case 46:c.selected=!0}c.$apply()}),c.$on("$destroy",function(){d.unbind("keydown"),e()}),d.bind("click",function(a){"osTextField"===a.target.id?(c.onFocus(),b.bind("click",function(a){"osTextField"===a.target.id?c.onFocus():a.button<1&&c.onBlur(a),c.$apply()})):a.button<1&&c.onBlur(a),c.$apply()}),c.handleSelection=function(b){a(function(){c.model=b,c.originalValue="",c.items={},c.setCurrent(-1,!1),c.dataRequested=!1,c.selected=!1,c.faqSearched=!1,c.$apply(),c.search()},0)}},templateUrl:"common/directives/suggest/suggest.tpl.html"}}]),angular.module("engines.acumen",[]).config(["oneSearchProvider",function(a){a.engine("acumen",{id:8,priority:3,resultsPath:"Acumen.data",totalsPath:"Acumen.metadata.numFound",templateUrl:"common/engines/acumen/acumen.tpl.html",controller:"AcumenCtrl"})}]).controller("AcumenCtrl",["$scope","$filter",function(a){for(var b=a.items,c=0,d=b.length;d>c;c++)b[c].type&&(b[c].type="text"==b[c].type[0]&&b[c].details&&b[c].details.genre?b[c].details.genre.sort().shift():b[c].type.sort().shift())}]),angular.module("engines.catalog",[]).config(["oneSearchProvider",function(a){a.engine("catalog",{id:64,priority:5,resultsPath:"Catalog.list",totalsPath:"Catalog.total",mediaTypes:{path:"bibFormat",types:{books:["aa","ac","ad","am"],journals:["ab","as","bb","bs","cb","cs","db","ds","eb","es","fb","fs","gb","gs","ib","is","jb","js","kb","ks","mb","ms","ob","os","pb","ps","rb","rs","tb","ts"]}},templateUrl:"common/engines/catalog/catalog.tpl.html",controller:"CatalogCtrl"})}]).filter("catalogSplitTitleAuthor",[function(){return function(a){if(a.indexOf("/")>-1){var b=a.split(/\s\/\sedited\sby\s([^.+]+)\./);a=b}return a}}]).controller("CatalogCtrl",["$scope","$filter",function(a,b){for(var c={bc:"Archive/Manuscript",cm:"Music Score",em:"Map",im:"Nonmusical Recording",jm:"Musical Recording",mm:"Computer File/Software",om:"Kit",pc:"Mixed Material/Collection",pm:"Mixed Material",rm:"Visual Material"},d=a.items,e=0;e<d.length;e++){var f=d[e].bibFormat;if(d[e].mediaType=c[f],!d[e].author){var g=b("catalogSplitTitleAuthor")(d[e].title);angular.isArray(g)&&(d[e].title=g[0],d[e].author=g[2])}}if(angular.isArray(a.resourceLinkParams)){var h="&limitTo=TYPE%3D",i=h+a.resourceLinkParams.join(h);a.resourceLink.indexOf("limitTo=")>0?a.resourceLink=a.resourceLink.replace(/(&limitTo=[^&]+)/,i):a.resourceLink+=i}a.items=d}]),angular.module("engines.databases",[]).config(["oneSearchProvider",function(a){a.engine("databases",{id:2,priority:1,resultsPath:"Databases.databases",totalsPath:"Databases.totalResults",templateUrl:"common/engines/databases/databases.tpl.html"})}]),angular.module("engines.ejournals",[]).config(["oneSearchProvider",function(a){
a.engine("ejournals",{id:4,priority:6,resultsPath:"eJournals.SearchResult.Data.Records",totalsPath:"Scout.SearchResult.Statistics.TotalHits",mediaTypes:{path:"Header.ResourceType",types:{books:"Book",journals:"Journal"}},templateUrl:"common/engines/ejournals/ejournals.tpl.html",controller:"EjouralsCtrl"})}]).controller("EjouralsCtrl",["$scope",function(a){for(var b,c,d,e=a.items,f=0;f<e.length;f++){if(b="",c="",d="",e[f].RecordInfo.BibRecord.BibEntity.Titles&&(b=e[f].RecordInfo.BibRecord.BibEntity.Titles[0].TitleFull,b&&(e[f].title=b)),e[f].RecordInfo.BibRecord.BibEntity.Identifiers){for(j=0;j<e[f].RecordInfo.BibRecord.BibEntity.Identifiers.length;j++){var g=e[f].RecordInfo.BibRecord.BibEntity.Identifiers[j].Type;if("issn-online"==g){c=e[f].RecordInfo.BibRecord.BibEntity.Identifiers[j].Value,c=c.slice(0,4)+"-"+c.slice(4,8);break}"issn-print"==g&&(c=e[f].RecordInfo.BibRecord.BibEntity.Identifiers[j].Value,c=c.slice(0,4)+"-"+c.slice(4,8))}c&&(e[f].ISSN=c)}for(j=0;j<e[f].FullTextHoldings.length;j++)if("undefined"!=typeof e[f].FullTextHoldings[j].CoverageDates){var h=e[f].FullTextHoldings[j].CoverageDates[0].StartDate;h=parseInt(h.slice(0,4)),""!==d?d>h&&(d=h):d=parseInt(h)}d&&(e[f].year=d)}a.items=e}]),angular.module("common.engines",["engines.acumen","engines.catalog","engines.databases","engines.scout","engines.googleCS","engines.faq","engines.libguides","engines.ejournals","engines.recommend","engines.staffdirectory"]).service("enginesTemplateFactory",["$http","$templateCache",function(a,b){this.get=function(a){return angular.isDefined(a.templateUrl)?this.fromUrl(a.templateUrl):null},this.fromUrl=function(c){return null==c?null:a.get(c,{cache:b,headers:{Accept:"text/html"}}).then(function(a){return a.data})}}]),angular.module("engines.faq",[]).config(["oneSearchProvider",function(a){a.engine("faq",{id:16,priority:2,resultsPath:"GoogleCS.items",totalsPath:"GoogleCS.searchInformation.totalResults",filterQuery:"site:ask.lib.ua.edu",templateUrl:"common/engines/google-cs/google-cs.tpl.html"})}]),angular.module("engines.googleCS",[]).config(["oneSearchProvider",function(a){a.engine("googleCS",{id:16,title:"Libraries' Website",priority:2,resultsPath:"GoogleCS.items",totalsPath:"GoogleCS.searchInformation.totalResults",filterQuery:"-site:guides.lib.ua.edu -site:ask.lib.ua.edu",templateUrl:"common/engines/google-cs/google-cs.tpl.html"})}]),angular.module("engines.libguides",[]).config(["oneSearchProvider",function(a){a.engine("libguides",{id:256,title:"Research Guides",priority:2,resultsPath:"LibGuides",templateUrl:"common/engines/libguides/libguides.tpl.html"})}]),angular.module("engines.recommend",[]).config(["oneSearchProvider",function(a){a.engine("recommend",{id:512,priority:0,resultsPath:"Recommendations",templateUrl:"common/engines/recommend/recommend.tpl.html"})}]),angular.module("engines.scout",[]).config(["oneSearchProvider",function(a){a.engine("scout",{id:1,priority:4,resultsPath:"Scout.SearchResult.Data.Records",totalsPath:"Scout.SearchResult.Statistics.TotalHits",mediaTypes:{path:"Header.PubTypeId",types:{books:["book","ebook"],articles:"academicJournal"}},resourceLink:{params:{books:["Books","eBooks"],articles:["AcademicJournals"],other:["News","Magazines","Reviews","Biographies","ConferenceMaterials","ElectronicResources","TradePublications","NonPrintResources","MusicScores","DissertationsTheses","PrimarySourceDocuments","Reports","Maps","Audio","Videos"]}},templateUrl:"common/engines/scout/scout.tpl.html",controller:"ScoutCtrl"})}]).controller("ScoutCtrl",["$scope",function(a){for(var b,c=a.items,d=0;d<c.length;d++){"audio"==c[d].Header.PubTypeId&&(c[d].mediaType="Audio"),"videoRecording"==c[d].Header.PubTypeId&&(c[d].mediaType="Video Recording"),c[d].RecordInfo.BibRecord.BibEntity.Titles&&(b=c[d].RecordInfo.BibRecord.BibEntity.Titles[0].TitleFull);var e=[];if(c[d].RecordInfo.BibRecord.hasOwnProperty("BibRelationships")&&angular.isDefined(c[d].RecordInfo.BibRecord.BibRelationships.IsPartOfRelationships)){e=c[d].RecordInfo.BibRecord.BibRelationships.IsPartOfRelationships;for(var f=0,g=e.length;g>f;f++)if(angular.isUndefined(b)&&e[f].BibEntity&&e[f].BibEntity.Titles&&(b=e[f].BibEntity.Titles[0].TitleFull),angular.isDefined(e[f].BibEntity.Identifiers)&&"issn-print"===e[f].BibEntity.Identifiers[0].Type&&(e[f].BibEntity.Titles&&(c[d].source=e[f].BibEntity.Titles[0].TitleFull),angular.isDefined(e[f].BibEntity.Numbering)))for(var h=0,i=e[f].BibEntity.Numbering.length;i>h;h++)c[d].source+=" "+e[f].BibEntity.Numbering[h].Type.substring(0,3)+"."+e[f].BibEntity.Numbering[h].Value}if(angular.isDefined(c[d].Items))for(var f=0;f<c[d].Items.length;f++)"Src"==c[d].Items[f].Group&&(c[d].source=c[d].Items[f].Data);c[d].title=b}a.items=c;var j,k=angular.copy(a.mediaType),l=angular.copy(a.resourceLink);a.resourceLinkParams[k]&&(j=a.resourceLinkParams[k].join(","),l.indexOf("facet=")>0?l=l.replace(/&facet=(.+)&?/,j):l+="&facet="+j),a.resourceLink=angular.copy(l)}]),angular.module("engines.staffdirectory",[]).config(["oneSearchProvider",function(a){a.engine("staffdirectory",{id:128,priority:5,resultsPath:"staffDir",templateUrl:"common/engines/staff-directory/staff-directory.tpl.html",controller:"StaffDirectoryCtrl"})}]).controller("StaffDirectoryCtrl",["$scope",function(a){for(var b=a.items,c=0,d=b.length;d>c;c++)if(b[c].email){var e=/^([\w-]+(?:\.[\w-]+)*)/,f=b[c].email.match(e);null!==f&&(b[c].emailPrefix=f[0])}}]),angular.module("filters.nameFilter",[]).filter("nameFilter",["$filter",function(){return function(a){if(a.indexOf(",")>-1){var b=a.split(",");a=b.map(function(a){return a.trim()}).reverse().join(" ")}return a}}]);var invertArrayToObject=function(a){var b={};return Object.keys(a).map(function(c){for(var d=0,e=a[c].length;e>d;d++)b[a[c][d]]=c}),b},hasOwnProperty=Object.prototype.hasOwnProperty;angular.module("common.mediaTypes",[]).provider("mediaTypes",[function(){function a(a){var b={};return angular.forEach(a,function(a,c){var d={};switch(typeof a){case"string":case"number":a=[a];break;case"object":a=toArray(a)}d[c]=a,d=invertArrayToObject(d),angular.extend(b,d)}),b}var b={other:{engines:[],loaded:!1}};this.type=function(a,c){b[a]||(b[a]={engines:[],loaded:!1}),b.other.engines.indexOf(c)>-1||b.other.engines.push(c),b[a].engines.push(c)},this.$get=["$parse",function(c){return{types:b,groupBy:function(b,d){var e={};if(angular.isObject(d)){var f,g,h=a(d.types),i=c(d.path);angular.forEach(b,function(a){f=i(a),g=h[f],angular.isUndefined(g)?(e.other||(e.other=[]),e.other.push(a)):(e[g]||(e[g]=[]),e[g].push(a))})}else e[d]=b;return e}}}]}]),angular.module("common.oneSearch",[]).factory("Search",["$http","$q",function(a,b){function c(c){var d=b.defer(),e="//wwwdev2.lib.ua.edu/oneSearch/api/search/"+c.s+"/engine/"+c.engine+"/limit/"+c.limit,f=a({method:"GET",url:e,timeout:d.promise}),g=f.then(function(a){return this.done=!0,a.data},function(){return b.reject("Error")});return g.done=!1,g.abort=function(){this.done=!0,d.resolve()},g["finally"](function(){g.abort=angular.noop,d=f=g=null,this.done=!1}),g}return{request:c}}]).provider("oneSearch",["mediaTypesProvider",function(a){var b={};this.engine=function(c,d){if(angular.isString(c)){var e={id:null,title:null,priority:10,resultsPath:null,totalsPath:null,mediaTypes:null,templateUrl:null,filterQuery:null,controller:null},f=angular.extend(e,d);f.id&&(f.mediaTypes?Object.keys(f.mediaTypes.types).map(function(b){a.type(b,c)}):(a.type(c,c),f.mediaTypes=c),f.name=c,b[c]=f)}else console.log({Error:"oneSearch engine must have STRING defined name",engineParams:d})},this.$get=["$q","$parse","$filter","$rootScope","enginesTemplateFactory","SearchParams","Search",function(a,c,d,e,f,g,h){return{engines:b,searchAll:function(a){angular.extend(a,g);var e=d("orderObjectBy")(b,"priority");return angular.forEach(e,function(d,e){var f={engine:d.id};angular.extend(f,a),null!==d.filterQuery&&(f.s+=" "+d.filterQuery),d.response=h.request(f),angular.isDefined(d.resultsPath)&&(d.getResults=c(d.resultsPath)),angular.isDefined(d.totalsPath)&&(d.getTotal=c(d.totalsPath)),d.getResourceLink=c("resourceLinks"),b[e]=d}),b},getEngineTemplate:function(a){return f.get(a)},getEngineController:function(a){return angular.isDefined(a.controller)?a.controller:null}}}]}]).controller("OneSearchCtrl",["$scope","$location","$rootScope","$window","oneSearch",function(a,b,c,d,e){function f(){for(var a in e.engines)e.engines[a].response&&!e.engines[a].response.done&&e.engines[a].response.abort()}a.searchText,a.search=function(){var c=a.scoutCheckbox,e=a.searchText;if(1==c&&""!==e)ga("send","event","oneSearch","scout_checkbox_click"),window.location="http://search.ebscohost.com/login.aspx?direct=true&site=eds-live&;scope=site&type=0&custid=s4594951&groupid=main&profid=eds&mode=and&authtype=ip,guest&bquery="+e;else if(a.searchText){a.searchText=a.searchText.replace(/[&\/\\#+()$~%':*?<>{}]/g," ").trim(),a.searchText=a.searchText.substring(0,150);var g=encodeURIComponent(a.searchText);if(f(),!b.path()||b.path().indexOf("/bento")<0){var h="#/bento/"+g;switch(b.host()){case"wwwdev2.lib.ua.edu":case"www.lib.ua.edu":h="//"+b.host()+h;break;case"localhost":h=b.absUrl().replace(/(#.*)/,"")+h;break;default:h="//www.lib.ua.edu"+h}d.location=h}else b.path("/bento/"+a.searchText)}},a.getRecommend=function(a){return $resource("//wwwdev2.lib.ua.edu/oneSearch/api/recommend/:search").query({search:a}).$promise.then(function(a){return a})},c.$on("$routeChangeSuccess",function(b,c){c&&a.searchText!==c.params.s&&(a.searchText=c.params.s)})}]).filter("orderObjectBy",function(){return function(a,b,c){function d(a,b){return a[b]}var e=[],f={};angular.forEach(a,function(a){e.push(a)}),e.sort(function(a,c){var e,f=b.split(".").reduce(d,a),g=b.split(".").reduce(d,c);return e=f===g?0:f>g?1:-1}),c&&e.reverse();for(var g=0,h=e.length;h>g;g++){var i=e[g].name;f[i]=e[g]}return f}});